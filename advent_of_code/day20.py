from collections import deque

text1 = """###############
#...#...#.....#
#.#.#.#.#.###.#
#S#...#.#.#...#
#######.#.#.###
#######.#.#...#
#######.#.###.#
###..E#...#...#
###.#######.###
#...###...#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############"""


text = """#############################################################################################################################################
#...#.........................#...#.......#...###.........#...###.....#.......#...#.....#...#.....#...#...#...#...###...#...#...........#...#
#.#.#.#######################.#.#.#.#####.#.#.###.#######.#.#.###.###.#.#####.#.#.#.###.#.#.#.###.#.#.#.#.#.#.#.#.###.#.#.#.#.#########.#.#.#
#.#.#.......#.............#...#.#...#.....#.#...#.....#...#.#...#...#...#.....#.#.#...#.#.#...#...#.#.#.#.#.#.#.#.....#...#.#...#.......#.#.#
#.#.#######.#.###########.#.###.#####.#####.###.#####.#.###.###.###.#####.#####.#.###.#.#.#####.###.#.#.#.#.#.#.###########.###.#.#######.#.#
#.#.###...#...#.....#.....#...#.....#.....#...#.#.....#...#...#.###.#.....###...#...#.#.#.....#...#.#.#.#.#.#.#.#...........###.#.#...###.#.#
#.#.###.#.#####.###.#.#######.#####.#####.###.#.#.#######.###.#.###.#.#######.#####.#.#.#####.###.#.#.#.#.#.#.#.#.#############.#.#.#.###.#.#
#.#.#...#.#...#...#.#.....#...#...#.#.....#...#.#.......#.#...#.....#.#.....#...#...#.#.#...#...#.#.#.#.#.#.#.#.#.###...#...#...#...#.....#.#
#.#.#.###.#.#.###.#.#####.#.###.#.#.#.#####.###.#######.#.#.#########.#.###.###.#.###.#.#.#.###.#.#.#.#.#.#.#.#.#.###.#.#.#.#.#############.#
#.#...#...#.#.#...#.#...#.#.#...#...#.#.....#...#...#...#.#.#.........#.#...#...#.....#.#.#.#...#.#.#.#.#.#.#.#.#...#.#...#.#.#.............#
#.#####.###.#.#.###.#.#.#.#.#.#######.#.#####.###.#.#.###.#.#.#########.#.###.#########.#.#.#.###.#.#.#.#.#.#.#.###.#.#####.#.#.#############
#.#...#...#.#.#...#.#.#...#.#...#.....#...#...#...#.#...#...#...#.....#.#...#.........#...#.#...#.#.#.#.#.#.#.#.#...#.#.....#.#...#...###...#
#.#.#.###.#.#.###.#.#.#####.###.#.#######.#.###.###.###.#######.#.###.#.###.#########.#####.###.#.#.#.#.#.#.#.#.#.###.#.#####.###.#.#.###.#.#
#...#...#...#.###.#.#...#...###.#.#...#...#...#...#...#.....#...#...#.#.#...#...###...#...#.#...#.#.#.#.#.#.#.#.#.....#.....#.#...#.#.#...#.#
#######.#####.###.#.###.#.#####.#.#.#.#.#####.###.###.#####.#.#####.#.#.#.###.#.###.###.#.#.#.###.#.#.#.#.#.#.#.###########.#.#.###.#.#.###.#
#.....#.....#...#.#.###.#.###...#.#.#.#.....#.....#...#.....#.###...#.#.#.#...#...#...#.#...#...#.#.#...#.#.#.#...#.........#.#...#.#.#.#...#
#.###.#####.###.#.#.###.#.###.###.#.#.#####.#######.###.#####.###.###.#.#.#.#####.###.#.#######.#.#.#####.#.#.###.#.#########.###.#.#.#.#.###
#...#.#...#...#.#.#.#...#...#...#.#.#.#...#.#.......#...#...#.#...#...#.#.#.#.....#...#...#...#.#.#...#...#.#...#.#.#...#...#.#...#.#...#...#
###.#.#.#.###.#.#.#.#.#####.###.#.#.#.#.#.#.#.#######.###.#.#.#.###.###.#.#.#.#####.#####.#.#.#.#.###.#.###.###.#.#.#.#.#.#.#.#.###.#######.#
#...#...#.....#...#.#.....#.#...#.#.#.#.#.#.#.###...#.....#.#.#...#.#...#.#.#...###.....#.#.#.#.#.#...#...#.#...#.#...#...#.#.#.###.#...#...#
#.#################.#####.#.#.###.#.#.#.#.#.#.###.#.#######.#.###.#.#.###.#.###.#######.#.#.#.#.#.#.#####.#.#.###.#########.#.#.###.#.#.#.###
#.#...............#.#...#.#.#.#...#.#.#.#...#...#.#...###...#...#.#.#...#.#.#...#...###.#.#.#.#.#...#.....#.#.#...#...#...#.#.#.#...#.#...###
#.#.#############.#.#.#.#.#.#.#.###.#.#.#######.#.###.###.#####.#.#.###.#.#.#.###.#.###.#.#.#.#.#####.#####.#.#.###.#.#.#.#.#.#.#.###.#######
#...###...........#...#...#...#...#.#.#.#.....#.#...#...#...#...#.#.....#.#.#...#.#.#...#.#.#.#...#...#.....#...#...#.#.#...#.#.#...#.......#
#######.#########################.#.#.#.#.###.#.###.###.###.#.###.#######.#.###.#.#.#.###.#.#.###.#.###.#########.###.#.#####.#.###.#######.#
###...#.............#.........#...#.#.#.#...#...###.#...#...#...#...#.....#...#.#.#.#...#.#.#.#...#.###...#...#...###...###...#.....#...#...#
###.#.#############.#.#######.#.###.#.#.###.#######.#.###.#####.###.#.#######.#.#.#.###.#.#.#.#.###.#####.#.#.#.###########.#########.#.#.###
#...#...#.....#...#...#.......#.###.#.#.#...#...#...#...#...#...#...#...#...#.#.#.#...#.#.#.#.#...#.#...#...#.#.....###...#...#...#...#...###
#.#####.#.###.#.#.#####.#######.###.#.#.#.###.#.#.#####.###.#.###.#####.#.#.#.#.#.###.#.#.#.#.###.#.#.#.#####.#####.###.#.###.#.#.#.#########
#.....#.#...#.#.#...###.......#...#.#.#.#...#.#.#.....#.###.#.###.....#...#.#.#.#...#.#S#...#...#.#.#.#.#...#.#.....#...#...#.#.#...#.......#
#####.#.###.#.#.###.#########.###.#.#.#.###.#.#.#####.#.###.#.#######.#####.#.#.###.#.#########.#.#.#.#.#.#.#.#.#####.#####.#.#.#####.#####.#
#.....#.#...#.#...#.#...#...#...#.#.#.#.#...#.#.#...#.#...#.#.#.......#.....#.#.#...#.###.......#.#.#.#.#.#.#.#.#...#...#...#.#.......#.....#
#.#####.#.###.###.#.#.#.#.#.###.#.#.#.#.#.###.#.#.#.#.###.#.#.#.#######.#####.#.#.###.###.#######.#.#.#.#.#.#.#.#.#.###.#.###.#########.#####
#.....#.#...#.....#...#...#.....#...#.#.#.###.#.#.#.#.#...#.#.#.......#.#...#.#.#...#.###.###...#.#.#.#.#.#...#...#.....#.###.#.......#.....#
#####.#.###.#########################.#.#.###.#.#.#.#.#.###.#.#######.#.#.#.#.#.###.#.###.###.#.#.#.#.#.#.###############.###.#.#####.#####.#
#.....#.....#...#...#...#...#.......#.#.#.#...#.#.#.#.#...#.#...#.....#...#.#.#...#.#.###...#.#.#.#...#...#...#...........#...#.#...#.......#
#.###########.#.#.#.#.#.#.#.#.#####.#.#.#.#.###.#.#.#.###.#.###.#.#########.#.###.#.#.#####.#.#.#.#########.#.#.###########.###.#.#.#########
#.........#...#.#.#...#.#.#...#...#.#...#.#...#.#.#...###.#...#.#.......#...#...#...#.#####...#...###.......#...#...#.......#...#.#...#.....#
#########.#.###.#.#####.#.#####.#.#.#####.###.#.#.#######.###.#.#######.#.#####.#####.###############.###########.#.#.#######.###.###.#.###.#
#.........#...#.#.#.....#.#.....#...#...#.#...#.#.#.......#...#...#...#.#...#...#.....#########.....#.....###.....#.#.#.....#.....#...#...#.#
#.###########.#.#.#.#####.#.#########.#.#.#.###.#.#.#######.#####.#.#.#.###.#.###.#############.###.#####.###.#####.#.#.###.#######.#####.#.#
#.....#...#...#...#.......#...........#.#.#...#.#.#.#.....#.#####.#.#.#.#...#...#.#...#...#####...#.#...#...#...#...#.#...#.#...#...#.....#.#
#####.#.#.#.###########################.#.###.#.#.#.#.###.#.#####.#.#.#.#.#####.#.#.#.#.#.#######.#.#.#.###.###.#.###.###.#.#.#.#.###.#####.#
#.....#.#.#.....#.........###...........#.....#...#.#.###.#...#...#.#.#.#.#...#.#...#.#.#.#####...#.#.#.....#...#.....#...#...#...###...#...#
#.#####.#.#####.#.#######.###.#####################.#.###.###.#.###.#.#.#.#.#.#.#####.#.#.#####.###.#.#######.#########.###############.#.###
#.#...#.#.#.....#...#...#.....#.................#...#.#...#...#.#...#.#.#...#.#.....#...#.#####...#...#.......#...#...#...#.......###...#...#
#.#.#.#.#.#.#######.#.#.#######.###############.#.###.#.###.###.#.###.#.#####.#####.#####.#######.#####.#######.#.#.#.###.#.#####.###.#####.#
#...#.#.#...#.....#...#.........#...............#.....#.#...###...###...#.....#...#.....#.#######...#...#...#...#...#.....#...#...#...#.....#
#####.#.#####.###.###############.#####################.#.###############.#####.#.#####.#.#########.#.###.#.#.###############.#.###.###.#####
#.....#.#...#...#.###...#...#...#...............#...#...#...........#.....#...#.#...#...#......E###...#...#...#...#...#.....#.#.....#...#...#
#.#####.#.#.###.#.###.#.#.#.#.#.###############.#.#.#.#############.#.#####.#.#.###.#.#################.#######.#.#.#.#.###.#.#######.###.#.#
#.......#.#.#...#.#...#...#...#.............#...#.#...#...#...#...#.#...#...#.#.###.#.......#.........#...#...#.#...#...#...#.#.......#...#.#
#########.#.#.###.#.#######################.#.###.#####.#.#.#.#.#.#.###.#.###.#.###.#######.#.#######.###.#.#.#.#########.###.#.#######.###.#
#.........#.#...#.#.#.....................#.#.###.#...#.#.#.#.#.#...###...#...#...#.........#.......#.....#.#.#.#.......#.###.#...#...#.#...#
#.#########.###.#.#.#.###################.#.#.###.#.#.#.#.#.#.#.###########.#####.#################.#######.#.#.#.#####.#.###.###.#.#.#.#.###
#...#.....#.....#.#...#.....#.............#...#...#.#.#.#.#.#.#...#.........#...#.....#.....###...#.........#...#.....#.#...#.#...#.#.#.#.###
###.#.###.#######.#####.###.#.#################.###.#.#.#.#.#.###.#.#########.#.#####.#.###.###.#.###################.#.###.#.#.###.#.#.#.###
#...#.###...#...#.....#...#.#.................#...#.#.#.#.#.#.#...#.......#...#.#.....#.#...#...#...#.........#.......#.#...#.#.###.#...#...#
#.###.#####.#.#.#####.###.#.#################.###.#.#.#.#.#.#.#.#########.#.###.#.#####.#.###.#####.#.#######.#.#######.#.###.#.###.#######.#
#...#...###...#.#...#.....#.................#.#...#.#...#...#.#.#...#.....#...#.#.###...#...#...#...#.......#.#.......#...#...#.....#...#...#
###.###.#######.#.#.#######################.#.#.###.#########.#.#.#.#.#######.#.#.###.#####.###.#.#########.#.#######.#####.#########.#.#.###
###.....#...#...#.#...#...#.........###...#...#...#.......###.#.#.#...#...#...#.#.#...#.....#...#.....#.....#...#...#...###.#.........#...###
#########.#.#.###.###.#.#.#.#######.###.#.#######.#######.###.#.#.#####.#.#.###.#.#.###.#####.#######.#.#######.#.#.###.###.#.###############
#...#...#.#.#...#...#...#...###...#.....#.......#.#...#...#...#.#.#...#.#.#...#...#...#.....#.....#...#.......#.#.#...#.....#...###...#.....#
#.#.#.#.#.#.###.###.###########.#.#############.#.#.#.#.###.###.#.#.#.#.#.###.#######.#####.#####.#.#########.#.#.###.#########.###.#.#.###.#
#.#...#...#.....#...#...........#.....#.........#...#.#.###...#.#.#.#.#.#...#.#...#...#...#.......#.....#...#.#.#...#...#.....#.....#...#...#
#.###############.###.###############.#.#############.#.#####.#.#.#.#.#.###.#.#.#.#.###.#.#############.#.#.#.#.###.###.#.###.###########.###
#.....#...#...#...###...............#.#.......#...###...#...#.#.#.#.#...###...#.#.#.....#.#...#...#...#...#...#.#...###.#.###...........#...#
#####.#.#.#.#.#.###################.#.#######.#.#.#######.#.#.#.#.#.###########.#.#######.#.#.#.#.#.#.#########.#.#####.#.#############.###.#
#.....#.#...#.#.#.............#.....#.........#.#.......#.#.#...#...#...........#.......#...#.#.#.#.#.#.......#.#...#...#.........#...#.#...#
#.#####.#####.#.#.###########.#.###############.#######.#.#.#########.#################.#####.#.#.#.#.#.#####.#.###.#.###########.#.#.#.#.###
#.......#...#...#.....#.....#...#...#...........#.......#.#...#.....#.................#.......#.#...#.#.#.....#.....#...#...#...#.#.#.#...###
#########.#.#########.#.###.#####.#.#.###########.#######.###.#.###.#################.#########.#####.#.#.#############.#.#.#.#.#.#.#.#######
#.........#...#.....#...#...#.....#...#.........#.......#...#...#...###...#...###...#.....#.....#.....#.#.###...#.....#...#.#.#.#...#...#...#
#.###########.#.###.#####.###.#########.#######.#######.###.#####.#####.#.#.#.###.#.#####.#.#####.#####.#.###.#.#.###.#####.#.#.#######.#.#.#
#...........#...#...#...#.....#...#...#.......#.......#.#...#.....###...#...#.#...#.......#...#...#...#.#.....#...#...#...#...#.#.....#...#.#
###########.#####.###.#.#######.#.#.#.#######.#######.#.#.###.#######.#######.#.#############.#.###.#.#.###########.###.#.#####.#.###.#####.#
#...###...#.....#.#...#.........#...#...#...#...#...#...#...#...#...#.......#.#...............#...#.#...#.......#...#...#.....#.#.#...#.....#
#.#.###.#.#####.#.#.###################.#.#.###.#.#.#######.###.#.#.#######.#.###################.#.#####.#####.#.###.#######.#.#.#.###.#####
#.#...#.#.#.....#...#.....#.........###...#.....#.#.....#...#...#.#.#...###.#.#...###...#...#####...#.....#...#...#...#...#...#.#.#...#.....#
#.###.#.#.#.#########.###.#.#######.#############.#####.#.###.###.#.#.#.###.#.#.#.###.#.#.#.#########.#####.#.#####.###.#.#.###.#.###.#####.#
#...#...#...#.....#...###...###...#...#...#...###.#.....#.#...#...#...#.#...#.#.#...#.#.#.#...#.......#...#.#.#.....#...#...###...#...#...#.#
###.#########.###.#.###########.#.###.#.#.#.#.###.#.#####.#.###.#######.#.###.#.###.#.#.#.###.#.#######.#.#.#.#.#####.#############.###.#.#.#
###...#...#...#...#.#...........#.#...#.#...#.....#.#...#.#...#...#.....#...#.#...#...#.#.#...#.........#...#...#...#.....#...#.....#...#.#.#
#####.#.#.#.###.###.#.###########.#.###.###########.#.#.#.###.###.#.#######.#.###.#####.#.#.#####################.#.#####.#.#.#.#####.###.#.#
#.....#.#...###.....#.........#...#.....#...#.....#...#.#...#...#.#...#.....#.###.....#...#.............#...#...#.#.....#.#.#.#.......###...#
#.#####.#####################.#.#########.#.#.###.#####.###.###.#.###.#.#####.#######.#################.#.#.#.#.#.#####.#.#.#.###############
#.....#.#.............#.......#...#...#...#.#.###.#.....#...#...#.#...#...#...#...#...#...#...#...#...#.#.#.#.#.#.....#.#...#.......###...###
#####.#.#.###########.#.#########.#.#.#.###.#.###.#.#####.###.###.#.#####.#.###.#.#.###.#.#.#.#.#.#.#.#.#.#.#.#.#####.#.###########.###.#.###
###...#.#...........#...#.......#...#...###...#...#...###...#...#.#.#.....#.#...#.#...#.#...#...#...#.#.#.#.#.#.....#.#.#.....#...#.....#...#
###.###.###########.#####.#####.###############.#####.#####.###.#.#.#.#####.#.###.###.#.#############.#.#.#.#.#####.#.#.#.###.#.#.#########.#
#...#...#.........#.......#...#...........#...#.......#...#...#.#.#.#.....#.#...#...#.#.#.....#.......#...#...#...#...#...###.#.#.#.....#...#
#.###.###.#######.#########.#.###########.#.#.#########.#.###.#.#.#.#####.#.###.###.#.#.#.###.#.###############.#.###########.#.#.#.###.#.###
#.#...###.......#.#...#.....#.........#...#.#.#.......#.#.#...#...#.###...#.....#...#...#...#.#.#.....#.......#.#...........#...#...###.#...#
#.#.###########.#.#.#.#.#############.#.###.#.#.#####.#.#.#.#######.###.#########.#########.#.#.#.###.#.#####.#.###########.###########.###.#
#...#...#.......#...#...#.....#.....#...###.#.#...#...#.#.#.......#...#...#.......#####.....#.#...###...#.....#.#...........###.......#.#...#
#####.#.#.###############.###.#.###.#######.#.###.#.###.#.#######.###.###.#.###########.#####.###########.#####.#.#############.#####.#.#.###
#.....#.#.................#...#.###.....#...#...#.#.#...#.#.......#...#...#.#.....###...#...#...#.......#.......#.........#.....#...#.#.#...#
#.#####.###################.###.#######.#.#####.#.#.#.###.#.#######.###.###.#.###.###.###.#.###.#.#####.#################.#.#####.#.#.#.###.#
#.#...#...###...............#...#.....#.#.#.....#.#.#...#.#.......#...#.#...#...#...#.#...#.....#.....#.#...........#...#...#.....#...#.....#
#.#.#.###.###.###############.###.###.#.#.#.#####.#.###.#.#######.###.#.#.#####.###.#.#.#############.#.#.#########.#.#.#####.###############
#...#...#.....#.....#.......#.###...#...#.#...#...#.#...#.....###...#...#...###...#...#.#.......#...#.#.#.........#.#.#.#...#...#...........#
#######.#######.###.#.#####.#.#####.#####.###.#.###.#.#######.#####.#######.#####.#####.#.#####.#.#.#.#.#########.#.#.#.#.#.###.#.#########.#
#.....#.....#...###...#.....#.#.....#...#...#.#...#.#.#.......#...#...#.....#...#.#.....#.#.....#.#.#.#.#...#.....#...#.#.#...#...#...#...#.#
#.###.#####.#.#########.#####.#.#####.#.###.#.###.#.#.#.#######.#.###.#.#####.#.#.#.#####.#.#####.#.#.#.#.#.#.#########.#.###.#####.#.#.#.#.#
#.#...#.....#.#...#...#.......#.....#.#.#...#...#.#.#.#.....#...#.#...#.#.....#.#.#.#...#.#...#...#.#.#.#.#.#.........#...###...#...#...#...#
#.#.###.#####.#.#.#.#.#############.#.#.#.#####.#.#.#.#####.#.###.#.###.#.#####.#.#.#.#.#.###.#.###.#.#.#.#.#########.#########.#.###########
#.#.....#...#.#.#...#...............#.#.#.#.....#.#.#.#.....#...#.#...#.#.#.....#.#.#.#.#...#.#...#.#.#.#.#.#.....#...#...#...#...#...###...#
#.#######.#.#.#.#####################.#.#.#.#####.#.#.#.#######.#.###.#.#.#.#####.#.#.#.###.#.###.#.#.#.#.#.#.###.#.###.#.#.#.#####.#.###.#.#
#.....#...#.#.#...#...#.......#.......#.#.#...#...#.#.#...#...#.#.#...#.#.#.#.....#.#.#.....#.#...#...#.#.#.#...#.#.....#...#.......#.....#.#
#####.#.###.#.###.#.#.#.#####.#.#######.#.###.#.###.#.###.#.#.#.#.#.###.#.#.#.#####.#.#######.#.#######.#.#.###.#.#########################.#
#.....#.###...###...#.#.#...#...###.....#.#...#.###.#.#...#.#.#.#.#.#...#.#.#.#.....#.#...###.#.....###...#.#...#.......#...#.......#.......#
#.#####.#############.#.#.#.#######.#####.#.###.###.#.#.###.#.#.#.#.#.###.#.#.#.#####.#.#.###.#####.#######.#.#########.#.#.#.#####.#.#######
#.#...#.#.............#.#.#.........#.....#.....#...#.#...#.#.#.#.#.#...#.#.#.#.#...#...#...#.#.....#...#...#.........#...#.#.....#...#...###
#.#.#.#.#.#############.#.###########.###########.###.###.#.#.#.#.#.###.#.#.#.#.#.#.#######.#.#.#####.#.#.###########.#####.#####.#####.#.###
#.#.#.#.#...#...........#.....#.....#.....###...#.#...#...#.#.#.#.#.###.#.#.#.#.#.#...#...#.#.#.......#.#...#.....#...###...#.....#.....#...#
#.#.#.#.###.#.###############.#.###.#####.###.#.#.#.###.###.#.#.#.#.###.#.#.#.#.#.###.#.#.#.#.#########.###.#.###.#.#####.###.#####.#######.#
#.#.#...#...#.#...............#...#...#...#...#...#...#.#...#.#.#...#...#.#...#.#...#...#.#.#.#...#...#...#.#...#.#.....#...#.....#.#.......#
#.#.#####.###.#.#################.###.#.###.#########.#.#.###.#.#####.###.#####.###.#####.#.#.#.#.#.#.###.#.###.#.#####.###.#####.#.#.#######
#...#...#.....#...............#...#...#.#...#.......#.#.#...#.#.....#...#.#.....#...#...#.#.#...#.#.#...#.#.#...#.#.....#...#.....#.#.#.....#
#####.#.#####################.#.###.###.#.###.#####.#.#.###.#.#####.###.#.#.#####.###.#.#.#.#####.#.###.#.#.#.###.#.#####.###.#####.#.#.###.#
#.....#.............###.......#...#...#.#...#.###...#.#...#.#.#.....#...#.#.#...#...#.#...#...#...#...#.#.#.#.#...#...###...#.......#...#...#
#.#################.###.#########.###.#.###.#.###.###.###.#.#.#.#####.###.#.#.#.###.#.#######.#.#####.#.#.#.#.#.#####.#####.#############.###
#...#.........#...#.....#...#...#...#.#.#...#...#...#.###...#.#.....#...#.#.#.#.....#...#...#.#...#...#...#.#.#.#...#...###...#...#...#...###
###.#.#######.#.#.#######.#.#.#.###.#.#.#.#####.###.#.#######.#####.###.#.#.#.#########.#.#.#.###.#.#######.#.#.#.#.###.#####.#.#.#.#.#.#####
#...#.###...#.#.#...#...#.#...#...#.#...#.#...#.#...#.......#.....#.#...#.#.#...#.......#.#...###.#.......#.#.#.#.#...#.....#.#.#...#.#.....#
#.###.###.#.#.#.###.#.#.#.#######.#.#####.#.#.#.#.#########.#####.#.#.###.#.###.#.#######.#######.#######.#.#.#.#.###.#####.#.#.#####.#####.#
#...#.#...#...#.#...#.#...#...#...#...###.#.#.#.#...#.....#.#.....#.#.#...#.#...#...#...#.###.....#...#...#.#.#.#.#...#...#.#.#.....#.......#
###.#.#.#######.#.###.#####.#.#.#####.###.#.#.#.###.#.###.#.#.#####.#.#.###.#.#####.#.#.#.###.#####.#.#.###.#.#.#.#.###.#.#.#.#####.#########
###.#.#.#...#...#...#.###...#...#.....#...#.#.#.#...#...#.#.#...#...#.#.###.#.#.....#.#.#...#...#...#.#...#.#.#.#.#...#.#.#.#.#...#.........#
###.#.#.#.#.#.#####.#.###.#######.#####.###.#.#.#.#####.#.#.###.#.###.#.###.#.#.#####.#.###.###.#.###.###.#.#.#.#.###.#.#.#.#.#.#.#########.#
#...#.#...#...###...#.#...#...#...#.....#...#.#.#...#...#.#.###.#.#...#...#...#.....#.#...#...#...###.....#...#...###.#.#...#...#.#...#...#.#
#.###.###########.###.#.###.#.#.###.#####.###.#.###.#.###.#.###.#.#.#####.#########.#.###.###.#######################.#.#########.#.#.#.#.#.#
#.....###...#...#.....#.....#.#.#...#...#.#...#.#...#.###.#.#...#.#.#...#.#.........#.###...#...............###.......#...#...###.#.#.#.#.#.#
#########.#.#.#.#############.#.#.###.#.#.#.###.#.###.###.#.#.###.#.#.#.#.#.#########.#####.###############.###.#########.#.#.###.#.#.#.#.#.#
#.........#...#...............#.#...#.#...#.#...#.....#...#.#...#.#...#.#.#...#.....#...#...#.....#.......#...#...#.....#...#...#...#...#...#
#.#############################.###.#.#####.#.#########.###.###.#.#####.#.###.#.###.###.#.###.###.#.#####.###.###.#.###.#######.#############
#...#...#...#...#.....#...#...#...#.#.#.....#.........#...#.#...#.....#.#.#...#...#...#.#.#...#...#.....#...#...#.#.#...#.....#.............#
###.#.#.#.#.#.#.#.###.#.#.#.#.###.#.#.#.#############.###.#.#.#######.#.#.#.#####.###.#.#.#.###.#######.###.###.#.#.#.###.###.#############.#
###...#...#...#...###...#...#.....#...#...............###...#.........#...#.......###...#...###.........###.....#...#.....###...............#
#############################################################################################################################################"""




def parse_input(text):
    i = 0
    for l in text.split("\n"):
        if l.find("S") > -1:
            start = (i, l.index("S"))
        if l.find("E") > -1:
            end = (i, l.index("E"))
        i+=1
    return [list(line) for line in text.split("\n")], start, end


def bfs(maze, start, end):
    directions = [(0, 1), (0, -1), (1, 0), (-1, 0)]
    rows, cols = len(maze), len(maze[0])

    queue = deque([(start, 0)])
    visited = set()
    visited.add(start)

    distances = {start: 0}
    path = []

    while queue:
        (current_x, current_y), current_distance = queue.popleft()
        path.append((current_x, current_y))

        if (current_x, current_y) == end:
            break

        for dx, dy in directions:
            nx, ny = current_x + dx, current_y + dy

            if 0 <= nx < rows and 0 <= ny < cols and maze[nx][ny] != '#' and (nx, ny) not in visited:
                visited.add((nx, ny))
                queue.append(((nx, ny), current_distance + 1))
                distances[(nx, ny)] = current_distance + 1

    return distances, path

def find_best_wall_to_remove(text, min_steps):
    maze, start, end = parse_input(text)

    remove_count = 0

    rows, cols = len(maze), len(maze[0])

    distances, path = bfs(maze, start, end)
    
    visited = set()

    directions = [(0, 1), (1, 0), (0, -1), (-1, 0)]

    for index, (x, y) in enumerate(path):
        visited.add((x,y))
        for dx, dy in directions:
            nx, ny = x + dx, y + dy

            if 0 <= nx < rows and 0 <= ny < cols and maze[nx][ny] == '#':
                nnx, nny = nx + dx, ny + dy

                if 0 <= nnx < rows and 0 <= nny < cols and maze[nnx][nny] != '#' and (nnx, nny) in path and not (nnx, nny) in visited:

                    next_index = path.index((nnx, nny))

                    steps_saved = next_index - index - 2

                    if steps_saved >= min_steps:
                        remove_count += 1

    return remove_count



def find_best_wall_to_remove_enhanced(text, max_cheat, min_steps):

    maze, start, end = parse_input(text)

    distances, path = bfs(maze, start, end)

    path_rev = path[::-1]
    num_tricks = 0
    for i in range(len(path_rev)):
        for j in range(i+1, len(path_rev)):
            pos1, pos2 = path_rev[i], path_rev[j]
            delta = abs(pos1[0]-pos2[0]) + abs(pos1[1]-pos2[1])
            if delta <= max_cheat:
                new_cost = distances[pos1] - distances[pos2]-delta
                if new_cost >= min_steps:
                    num_tricks +=1

    return num_tricks



# saved_steps = find_best_wall_to_remove(text1, 20)
# print("saved steps: ", saved_steps)


# saved_steps_2 = find_best_wall_to_remove_enhanced(text1, 20, 72)
# print("saved steps: ", saved_steps_2)


saved_steps = find_best_wall_to_remove(text, 100)
print("saved steps: ", saved_steps)


saved_steps_2 = find_best_wall_to_remove_enhanced(text, 20, 100)
print("saved steps: ", saved_steps_2)